# Concept

Basic building blocks of MK are product, partner, pricelist and documents. With them, we can describe event in company bussiness timeline. Customer can get an 'offer', we issue a 'bill' or we purchase amount with 'acceptance form'. All this are documents. 

## Call types
We support the following REST calls on all supported documents :
* put\_document
* update\_document
* delete\_document
* get\_document
* get\_change\_documents - return list of documents that change after last call.

Not all calls are (yet) supported for every document type. We add support base on custumer needs.

Currenty we support :

Document type                | Put | Update | Delete | Get | GetChangeDocument|
-----------------------------|-----|--------|--------|-----|------------------|
warehouse\_delivery\_note    |X    |X       |X       |X    | X                |
warehouse\_packing\_list     |X    |X       |X       |X    | X                |
warehouse\_receiving\_note   |X    |X       |X       |X    | X                |
warehouse\_acceptance\_note  |X    |X       |X       |X    | X                |
sales_order                  |X    |        |        |     |                  |

## Building blocks
All calls have very simmilar JSON structure. Let's describe the most importand parts.

### Document Head
Document head includes authentication parameters, type of send document and some basic document paramethers.

**Example** (Warning : this is only part of required call structure):
```javascript
{
    "secret_key":"seckey",
    "company_id":"16",
    "doc_type": "warehouse_delivery_note",
    "count_code": "dob10",
    "doc_date": "2014-05-20+02:00",
}
```

Notes :
* secret_key - secret value, get from MK.
* company_id - public value, get from MK.
* doc_type - document type. See [Call types](#call types)
* count_code - document number. It can be insert by REST call or automatically generated by MK. 
* doc_date - Document date.

### Partner

**Example** (Warning : this is only part of required call structure):
```javascript
{
   "partner":{
      "business_entity":"true",
      "taxpayer":"true",
      "foreign_county":"false",
      "tax_id_number":"SI10040073",
      "customer":"eshop 1",
      "street":"Slovenska cesta 100",
      "post_number":"1000",
      "place":"Ljubljana",
      "country":"Slovenia",
      "partner_contact": {
         "name": "Rok Doltar",
         "phone": "05 320 24 88",
         "fax": "05 320 24 84",
         "gsm": "071 333 444",
         "email": "test@test.co.uk"
       }
   }
}
```
Notes :
* partner_contact - not required parameter

### Product list

**Example** (Warning : this is only part of required call structure):
```javascript
"product_list":[
      {
         "count_code":"2",
         "amount":"10",
         "price":"11",
         "discount":"12",
         "tax":"085"         
      },
      {
         "code":"eshop_artikel_1",
         "amount":"20",
         "price":"21",
         "discount":"22",
         "tax":"200"         
      },
      {
         "count_code":"eshop_artikel_2",
         "code":"eshop_artikel_2",
         "name":"eshop_artikel_2",
         "name_desc":"eshop_artikel_2 opis",
         "unit":"kom",
         "service":"false",
         "sales":"true",
         "purchasing":"false",
         "amount":"30",
         "price":"31",
         "discount":"32",
         "tax":"000"
      }      
   ]   
```

### Respond
**Example** (Warning : this is only part of required call structure):
```javascript
{
    "opr_code": "0",
    "opr_time_ms": "441",
    "mk_id": "1600129491",
    "count_code": "dob4"
}
```

Notes :
* opr_code - status code of operation. '0' is OK, other values are error.
* mk_id - put_document call will return new insert document id.
* count_code - put_document call will return new insert document number.

## put_document

**URL** : https://main.metakocka.si/rest/eshop/v1/put_document


**URL** : https://main.metakocka.si/rest/eshop/v1/json/add_payment

**Request example**
```javascript
{
   "secret_key":"my_secret",
   "company_id":"16",
   "doc_type" : "bill",
   "mk_id":"1600001744",
   "count_code":"eshop_002",   
   "payment_mode" : "payment",
   "payment_type" : "Transaction bill"
   "cash_register" : "Cashregister 1"
   "date" : "2014-08-23+02:00"
   "price" : "12.23"
   "notes" : "bla bla bla"
}
```

**Respond example**
```javascript
{
    "opr_code":"0",
    "opr_time_ms":"33",
}
```

